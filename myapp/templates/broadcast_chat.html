{% extends "chat_base.html" %}

{% block "title" %}using subscribe-broadcast{% endblock %}

{% block introduction %}
    <p>Point a second browser onto this URL and check for message synchronization.</p>
{% endblock introduction %}

{% block script_panel %}
    <script type="text/javascript">
        var ws4redis;

        jQuery(document).ready(function ($) {
            ws4redis = new WS4Redis({
                uri: 'ws://127.0.0.1:8000/ws/foobar?subscribe-broadcast&publish-broadcast&echo',
                heartbeat_msg: {{ WS4REDIS_HEARTBEAT }},
                receive_message: receive_message
            });

            var billboard = $('#billboard');
            var text_message = $('#text_message');

            // send message though the Websocket to the server
            text_message.keydown(function (event) {
                if (event.keyCode === 13) {
                    event.preventDefault();
                    send_message();
                }
            });

            $('#send_message').click(function () {
                send_message();
            });

            function send_message() {
                ws4redis.send_message(text_message.val());
                text_message.val('');
            }

            // receive a message though the Websocket from the server
            function receive_message(msg) {
                billboard.append('<br/>' + msg);
                billboard.scrollTop(billboard.scrollTop() + 25);
            }
        });
    </script>
{% endblock %}
